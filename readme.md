![GitHub User's stars](https://img.shields.io/github/stars/hoseinnikkhah?style=social)
![GitHub forks](https://img.shields.io/github/forks/hoseinnikkhah/ThesisEKR_Model)

![Static Badge](https://img.shields.io/badge/Finished-Finished?style=flat&logo=github&logoColor=white&label=Status&color=green) ![GitHub commit activity](https://img.shields.io/github/commit-activity/t/hoseinnikkhah/ThesisEKR_Model?color=magenta) ![GitHub License](https://img.shields.io/github/license/hoseinnikkhah/ThesisEKR_Model?style=flat&label=License&color=yellow)
![Static Badge](https://img.shields.io/badge/Matlab-1.1.2-teal.svg?logo=data:image/svg%2bxml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMTI4IDEyOCI+PGRlZnM+PGxpbmVhckdyYWRpZW50IGlkPSJkZXZpY29uTWF0bGFiMCIgeDE9IjE2LjgwMyIgeDI9IjE1LjAxMyIgeTE9IjE2LjYzMSIgeTI9IjIyLjQxMSIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCg0IDAgMCAtNCAwIDEyOCkiIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiM1MTIiLz48c3RvcCBvZmZzZXQ9Ii4yMyIgc3RvcC1jb2xvcj0iIzUyMyIvPjxzdG9wIG9mZnNldD0iLjM2IiBzdG9wLWNvbG9yPSIjNTM0Ii8+PHN0b3Agb2Zmc2V0PSIuNTEiIHN0b3AtY29sb3I9IiM2NDUiLz48c3RvcCBvZmZzZXQ9Ii42NiIgc3RvcC1jb2xvcj0iIzU2OCIvPjxzdG9wIG9mZnNldD0iLjg0IiBzdG9wLWNvbG9yPSIjMjlkIi8+PC9saW5lYXJHcmFkaWVudD48bGluZWFyR3JhZGllbnQgaWQ9ImRldmljb25NYXRsYWIxIiB4MT0iMjkuNzEiIHgyPSIxMS43MSIgeTE9IjE4Ljk4MyIgeTI9IjE0LjU2MyIgZ3JhZGllbnRUcmFuc2Zvcm09InNjYWxlKDQpIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+PHN0b3Agb2Zmc2V0PSIuMDgxIiBzdG9wLWNvbG9yPSIjYzMzIi8+PHN0b3Agb2Zmc2V0PSIuMTg5IiBzdG9wLWNvbG9yPSIjZGU1MjM5Ii8+PHN0b3Agb2Zmc2V0PSIuMzEzIiBzdG9wLWNvbG9yPSIjZjA2ZTNlIi8+PHN0b3Agb2Zmc2V0PSIuNDIxIiBzdG9wLWNvbG9yPSIjZmE4MDQyIi8+PHN0b3Agb2Zmc2V0PSIuNSIgc3RvcC1jb2xvcj0iI2ZlODY0MyIvPjxzdG9wIG9mZnNldD0iLjU4IiBzdG9wLWNvbG9yPSIjZmE3ZjQyIi8+PHN0b3Agb2Zmc2V0PSIuNjk2IiBzdG9wLWNvbG9yPSIjZWY2YzNlIi8+PHN0b3Agb2Zmc2V0PSIuODMzIiBzdG9wLWNvbG9yPSIjZGM0YzM3Ii8+PHN0b3Agb2Zmc2V0PSIuOTE2IiBzdG9wLWNvbG9yPSIjY2YzNjMzIi8+PC9saW5lYXJHcmFkaWVudD48L2RlZnM+PHBhdGggZmlsbD0iIzQ5ZCIgZD0ibTggNzAuMmwzMS44NzktMTIuODhhODIuNiA4Mi42IDAgMCAxIDEwLjg4My0xMS44YzIuNjM2LTEuMzk5IDcuNTk3LS42NDEgMTYuNjgtMTEuOTE4YzguNzk2LTExIDExLjU5Ny0yMC40MDMgMTUuNzE4LTIwLjQwM2M2LjUyIDAgMTEuMzIgMTQuMDgyIDE4LjYwMiAzNS40MDNBNDYyIDQ2MiAwIDAgMCAxMjAgOTYuNDhjLTcuNjAyLTcuMDgyLTE0LjA3OC0xNC43MTgtMjEuNDgtMTQuNTJjLTYuODguMTYxLTE0LjUyIDguMzIxLTIyLjg4IDE4LjgwMkM2OSAxMDkuMTYgNjAuMiAxMTQuOTIyIDU2Ljc2MyAxMTQuOGMwIDAtOC44ODMtMjUuMTIxLTE2LjMyLTI5LjJhMTAuNTYgMTAuNTYgMCAwIDAtOS41NjMuNzk3TDggNzAuMTZ6bTAgMCIvPjxwYXRoIGZpbGw9InVybCgjZGV2aWNvbk1hdGxhYjApIiBkPSJNNzkuMiAxNi4wNzhjLTIuNjggMy42MDItNS45MiAxMC4yMDMtMTEuNzYgMTcuNTI0Yy05LjA4MiAxMS4yNzctMTQgMTAuNTItMTYuNjggMTEuOTE4YTc4LjcgNzguNyAwIDAgMC0xMC44ODIgMTEuOGwxMy4yIDkuNjRDNjQuMjggNTEuNjggNzAuMjggMzUuMTIyIDc0Ljk2IDI0LjM5OWE1NC43IDU0LjcgMCAwIDEgNC4yMzgtOC4zMnptMCAwIi8+PHBhdGggZmlsbD0idXJsKCNkZXZpY29uTWF0bGFiMSkiIGQ9Ik04My4yIDEzLjJjLTguNzIgMC0xNC42OCA0NS45MjEtNDYuODggNzEuNTYyYzkuMDQtMS40OCAxNi44OCAyMC45NTcgMjAuNDggMzAuMDM5YzE2LTIuNzIzIDI4LjgwMi0zMy4zMiA0MS43Mi0zMi44NGM3LjQwMi4yNzcgMTMuODc4IDcuNDM3IDIxLjQ4IDE0LjUyQzEwMi42NCA2MCA5NC41MiAxMy4xOTggODMuMiAxMy4xOTh6bTAgMCIvPjwvc3ZnPg==)


# Debugging Stages
* Run the code in MATLAB

***
## # 1

* Several errors come up which were expected, the first thing we've encountered is in this line of code
```matlab
s_H(:,1) = (z_H^2)*v_H*G_H(:,1);
s_OH(:,1) = (z_OH^2)*v_OH*G_OH(:,1);
s_C(:,1) = (z_C^2)*v_C*G_C(:,1);
Sigma(:,1) = (F^2)*(s_H + s_OH + s_C);
```
* As we are only changing values for all x nodes in initial time node we need to add `(:,1)` to fix the error, ideally we will have the following code

```matlab
s_H(:,1) = (z_H^2)*v_H*G_H(:,1);
s_OH(:,1) = (z_OH^2)*v_OH*G_OH(:,1);
s_C(:,1) = (z_C^2)*v_C*G_C(:,1);
Sigma(:,1) = (F^2)*(s_H(:,1) + s_OH(:,1) + s_C(:,1));
```
## # 2

* In this line we are using `alpha` which is not defined in code and it should be 1alpha_C` instead. not to mention all concentration should be for Carbon or `G_C` in initial code I have used `G` which is not mentioned in this code.
```matlab
G_C(i,m+1) = G_C(i,m) + sub(i,m)*(alpha*(G_C(i+1,m) -2*G_C(i,m) + G_C(i-1,m)) + beta_C*(G(i+1,m) - G(i-1,m)) + R_C(i,m)/R_D);
```
* So new code will look like this:
```matlab
G_C(i,m+1) = G_C(i,m) + sub(i,m)*(alpha_C*(G_C(i+1,m) -2*G_C(i,m) + G_C(i-1,m)) + beta_C*(G_C(i+1,m) - G_C(i-1,m)) + R_C(i,m)/R_D);
```
## # 3

* In line 250 we face this code:
```matlab
G_HA(i,m+1) = G_HA(i,m) + sub(i,m)*(alpha_HA*(G_HA(i+1,m) -2*G_HA(i,m) + G_HA(i-1,m)) + beta_HA*(G_HA(i+1,m) - G_HA(i-1,m)) + R_HA(i,m)/R_D);
```
* This is mainly because we have not created any of active models arays, to do so these lines of codes were added

```matlab
G_HA = zeros(nx,nt);
G_BOH = zeros(nx,nt);
G_A = zeros(nx,nt);
G_B = zeros(nx,nt);
```
## # 4

* Following code returned an unknown parameter error
```matlab
G_HA(i,m+1) = G_HA(i,m) + sub(i,m)*(alpha_HA*(G_HA(i+1,m) -2*G_HA(i,m) + G_HA(i-1,m)) + beta_HA*(G_HA(i+1,m) - G_HA(i-1,m)) + R_HA(i,m)/R_D);
```

* This is because reaction rates were not included for this part of model, after adding needed parameter problem fixed for both acid and base

## # 5

* Since rate for both acid and base are only calculated separately at both x=0 and x=L there are two conditional if in code, though a mistake happened and made both R_prime for acid and base as array which is wrong. As result following line of code resulted in returning syntax error

```matlab
R_OH(i,m) = -1*R_prime_OH(i,m);
```
and
```matlab
R_H(i,m) = -1*R_prime_H(i,m);
```
* In order to fix the issue we need to remove `(i,m)` from prime values.
***
# Plots

##### After running the code, it is expected to recive some plots coressponding to values given and constants, it is expected to have something like picture below:

Pic1

How ever this is not the case in modified code and no plots appear, it is assumed to have an issue with constants but to make sure everything is fine mat data of original code and modified one were exported to make sure everything aligns within accepted margin.

So basically, there are two mat files, one is `test.mat` and the other one is `final.mat` which final is all about modified code as it is going to be our final code usable in this repo


* 1. Valency changes:

In this term all values related to this changed naming upon to what species we are dealing with, basically `z1` `z2` `z3` changed to `z_H1 z_OH` `z_C` and so on.
Does it seem to affect plots? No ❌

* 2. Physical Info

These values are mostly keeping their naming mechanism however some values were removed as instance there is no value after electric field in old code but there is one with `phi` except these changes epsilon for each specie has been removed, this needs some confirmation but epsilon seems to only applied to solution not each species in domain.
Does it seem to affect plots? No ❌

* 3. Diffusion and primary advection

These values are essentially as same as old code so it isn't expected to consider these values essential for this error, although the most effective value in advection for plots are these values, unlike the old code in this one all parameters are in one block and are sorted based on what value and species we are dealing, that being said some names for these values might have change/removed or added. Even with these changes values within the parameters are same.

Does it seem to affect plots? No ❌ (Only for plot issue we have)

* 4. Velocity field

Same as diffusion, they might have several differences when it comes to value and names but are not considered too much of a change however a simple change might change the velocity compared to old code which is reflected in total velocity value, in this new code a new form of velocity has been added an it is convection velocity, since it is a big parameter, it leads into huge offsets which is not expected to see in this code

Does it seem to affect plots? Yes ✔

# Value differences

In order to check and validate differences in both working codes, mat files of both were created, with the help of compare tool within MATLAB we can locate what has been added or what has been removed. In this specific case most of variables changed their names but not values, so basically almost all the variables are same as before however some parameters have changed in a meaningful way so it is worth mentioning what are these variables.

***

# What do we solve?

Generally speaking, this code contains EKR and BKR however finished code I am sharing here does only have Bio-EKR, although it can be instituted with EKR only with changing diffusion and velocity advections with proper terms already calculated in the code

# Images

![image](https://github.com/hoseinnikkhah/ThesisEKR_Model/assets/116885462/44bab805-75ea-40a2-9e4f-a9e7ac34d3de)

![image](https://github.com/hoseinnikkhah/ThesisEKR_Model/assets/116885462/30fb5968-227a-4538-8a22-63988a4df2a8)


